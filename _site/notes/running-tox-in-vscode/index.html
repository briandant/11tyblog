<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/output.css" />
  </head>
<body class="flex flex-col min-h-screen text-black bg-slate-100 text-opacity-85" style="font-family: Georgia, 'Times New Roman', Times, serif;"></body>
    <header class="mb-4 px-8 pt-8">
      <h1>
        <a href="/">briandant.com</a>
      </h1>
    </header>
    <nav>
      <ul>
      
      
      
      </ul>
    </nav>
    <main class="px-8">
        <main>
  <article aria-labelledby="post-title">
    <header>
      <h2 id="post-title" class="text-xl">running make and tox targets in VS Code, under nix</h2>
    </header>
    <p class="text-xs text-slate-600">Published on
      <time datetime="Sat Oct 26 2024 10:29:48 GMT-0400 (Eastern Daylight Time)">Sat Oct 26 2024 10:29:48 GMT-0400 (Eastern Daylight Time)</time>
    </p>
    <section class="mt-4">
      <p>I've been a bit skiddish about running processes in the VS Code terminal.  Generally, the VS Code default mode does too much: auto-loading the venv, grabbing env vars from <code>.env</code>, and so on.  And I find myself with excess terminals that I forget to clean up well.</p>
<p>One of the weird things is that there was an env var being set each time a new terminal was opened, and I couldn't easily understand why.  I never really figured it out.  I'd kill VS Code, and the next instance would have the env var there.  I'm sure I could figure out why with some work, but I just defaulted to running things in iTerm, for the most part.</p>
<p>But I want to give it more effort.  Today, I'm now trying to run my <code>make</code> and <code>tox</code> targets in VS Code.  This way I can simply open the tasks pallete, run the task, and get on with my work while, e.g., the test suite runs.  Simple VS Code tasks to do this:</p>
<pre><code class="language-json">{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    &quot;version&quot;: &quot;2.0.0&quot;,
    &quot;tasks&quot;: [
        {
            &quot;label&quot;: &quot;tox -e py3&quot;,
            &quot;type&quot;: &quot;shell&quot;,
            &quot;command&quot;: &quot;nix develop --command sh -c tox -e py3&quot;,
        },
        {
            &quot;label&quot;: &quot;make&quot;,
            &quot;type&quot;: &quot;shell&quot;,
            &quot;command&quot;: &quot;nix develop --command sh -c make&quot;,
        }
    ]
}
</code></pre>
<p>We use <code>nix flakes</code>, but I wasn't sure about setting the nix environment before the task runs.  I think there's a plugin, but I didn't want to mess with it.  Though, having all shells default to a nix-shell would be good, and maybe there's a way to do that, so flakes doesn't have to do all it's check before each task.</p>

    </section>
  </article>
</main>

    </main>
    <footer class="p-8 mt-auto bg-white">
        <p>
        <a class=" underline" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
            rel="noopener noreferrer">Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
    </footer>
  </body>
</html>
